# æ‰“åŒ…éƒ¨ç½²è„šæœ¬è¯´æ˜

è¿™ä¸ªè„šæœ¬ç”¨äºå°† IKU Research Agent é¡¹ç›®æ‰“åŒ…æˆ ZIP æ–‡ä»¶ï¼Œæ–¹ä¾¿éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… è‡ªåŠ¨æ£€æŸ¥å¿…éœ€æ–‡ä»¶ï¼ˆ.next æ„å»ºäº§ç‰©ç­‰ï¼‰
- âœ… æ™ºèƒ½æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ï¼ˆnode_modulesã€å¼€å‘æ–‡ä»¶ç­‰ï¼‰
- âœ… æ”¯æŒå¤šç¯å¢ƒæ‰“åŒ…ï¼ˆproduction/developmentï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆéƒ¨ç½²æŒ‡å—æ–‡æ¡£
- âœ… ä¼˜åŒ–çš„æ–‡ä»¶å‹ç¼©ï¼ˆæœ€é«˜å‹ç¼©çº§åˆ«ï¼‰
- âœ… è¯¦ç»†çš„æ‰“åŒ…è¿›åº¦å’Œç»Ÿè®¡ä¿¡æ¯
- âœ… åŒ…å«é¡¹ç›®ç‰¹å®šé…ç½®ï¼ˆTypeScriptã€Tailwindã€pnpmç­‰ï¼‰

## ä½¿ç”¨æ–¹æ³•

### 1. ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…ï¼ˆæ¨èï¼‰

```bash
# æ–¹å¼1: å…ˆæ„å»ºå†æ‰“åŒ…ï¼ˆæ¨èï¼‰
pnpm run build:pack

# æ–¹å¼2: åªæ‰“åŒ…ï¼ˆéœ€è¦å…ˆæ‰‹åŠ¨ buildï¼‰
pnpm run pack:prod
```

### 2. å¼€å‘ç¯å¢ƒæ‰“åŒ…

```bash
# å…ˆæ„å»ºå†æ‰“åŒ…å¼€å‘ç¯å¢ƒ
pnpm run build:pack:dev

# åªæ‰“åŒ…å¼€å‘ç¯å¢ƒ
pnpm run pack:dev
```

### 3. ç›´æ¥è¿è¡Œè„šæœ¬

```bash
# ç”Ÿäº§ç¯å¢ƒ
node scripts/pack-deploy.js --env=production

# å¼€å‘ç¯å¢ƒ
node scripts/pack-deploy.js --env=development

# æŸ¥çœ‹å¸®åŠ©
node scripts/pack-deploy.js --help
```

## æœåŠ¡å™¨ç«¯å¿«é€Ÿéƒ¨ç½²

ä¸ºäº†ç®€åŒ–æœåŠ¡å™¨ç«¯çš„éƒ¨ç½²æµç¨‹ï¼Œé¡¹ç›®æä¾›äº† `server-deploy.sh` è„šæœ¬ã€‚

### ä½¿ç”¨å¿«é€Ÿéƒ¨ç½²è„šæœ¬

1. **ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨**
   ```bash
   # ä¸Šä¼ éƒ¨ç½²åŒ…å’Œéƒ¨ç½²è„šæœ¬
   scp dist/iku-research-agent-*.zip scripts/server-deploy.sh user@server:/var/www/
   ```

2. **åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œè„šæœ¬**
   ```bash
   # SSH ç™»å½•æœåŠ¡å™¨
   ssh user@server
   cd /var/www/
   
   # æ·»åŠ æ‰§è¡Œæƒé™å¹¶è¿è¡Œ
   chmod +x server-deploy.sh
   bash server-deploy.sh
   ```

3. **è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆä»¥ä¸‹æ“ä½œ**ï¼š
   - âœ… æ£€æŸ¥ Node.jsã€pnpmã€PM2 ç¯å¢ƒ
   - âœ… è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„å·¥å…·
   - âœ… å¤‡ä»½æ—§ç‰ˆæœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
   - âœ… è§£å‹éƒ¨ç½²åŒ…
   - âœ… åˆ›å»ºå¿…éœ€ç›®å½•
   - âœ… å®‰è£…é¡¹ç›®ä¾èµ–
   - âœ… æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
   - âœ… ä½¿ç”¨ PM2 å¯åŠ¨åº”ç”¨
   - âœ… è®¾ç½®å¼€æœºè‡ªå¯åŠ¨

### å¿«é€Ÿéƒ¨ç½²ä¼˜åŠ¿

- ğŸš€ **ä¸€é”®éƒ¨ç½²**ï¼šæ— éœ€æ‰‹åŠ¨æ‰§è¡Œå¤šä¸ªå‘½ä»¤
- âœ… **ç¯å¢ƒæ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£…æ‰€éœ€å·¥å…·
- ğŸ’¾ **è‡ªåŠ¨å¤‡ä»½**ï¼šæ›´æ–°æ—¶è‡ªåŠ¨å¤‡ä»½æ—§ç‰ˆæœ¬
- ğŸ”„ **æ™ºèƒ½é‡å¯**ï¼šæ£€æµ‹ç°æœ‰å®ä¾‹ï¼Œæ”¯æŒå¹³æ»‘é‡å¯
- ğŸ“‹ **äº¤äº’å¼é…ç½®**ï¼šå‹å¥½çš„äº¤äº’æç¤ºï¼Œé¿å…è¯¯æ“ä½œ

## æ‰“åŒ…å†…å®¹

### åŒ…å«çš„æ–‡ä»¶/ç›®å½•

- **æ„å»ºäº§ç‰©**: `.next/` - Next.js æ„å»ºè¾“å‡º
- **é…ç½®æ–‡ä»¶**: 
  - `next.config.mjs` - Next.js é…ç½®
  - `package.json` / `pnpm-lock.yaml` - ä¾èµ–ç®¡ç†ï¼ˆæœåŠ¡å™¨å®‰è£…ä¾èµ–å¿…éœ€ï¼‰
  - `ecosystem.config.js` - PM2 è¿›ç¨‹ç®¡ç†é…ç½®
  - `tsconfig.json` - TypeScript é…ç½®
  - `tailwind.config.ts` - Tailwind CSS é…ç½®
  - `postcss.config.mjs` - PostCSS é…ç½®
- **æºä»£ç **:
  - `app/` - Next.js App Router
  - `components/` - React ç»„ä»¶
  - `actions/` - Server Actions
  - `helpers/` / `hooks/` / `utils/` - å·¥å…·å‡½æ•°
  - `types/` - TypeScript ç±»å‹å®šä¹‰
  - `config/` - é…ç½®æ–‡ä»¶
  - `styles/` - æ ·å¼æ–‡ä»¶
- **é™æ€èµ„æº**: `public/` - å›¾ç‰‡ã€å›¾æ ‡ç­‰
- **ç¯å¢ƒå˜é‡**: `.env.production` æˆ– `.env.development`

### æ’é™¤çš„æ–‡ä»¶/ç›®å½•

- `node_modules/` - ä¾èµ–åŒ…ï¼ˆæœåŠ¡å™¨è‡ªå·±å®‰è£…ï¼‰
- `.git/` - Git ä»“åº“
- `.vscode/` / `.idea/` - ç¼–è¾‘å™¨é…ç½®
- `dist/` / `out/` - æ„å»ºè¾“å‡ºç›®å½•
- `*.log` - æ—¥å¿—æ–‡ä»¶
- `.env.local` - æœ¬åœ°ç¯å¢ƒå˜é‡
- `scripts/` - æ‰“åŒ…è„šæœ¬
- `README.md` / `*.md` - æ–‡æ¡£æ–‡ä»¶
- Docker ç›¸å…³æ–‡ä»¶ï¼ˆå¦‚æœä¸ä½¿ç”¨ Docker éƒ¨ç½²ï¼‰

## è¾“å‡ºç»“æœ

æ‰“åŒ…æˆåŠŸåï¼Œä¼šåœ¨ `dist/` ç›®å½•ä¸‹ç”Ÿæˆï¼š

```
dist/
â”œâ”€â”€ iku-research-agent-production-v0.1.74-2026-02-05.zip  # éƒ¨ç½²åŒ…
â””â”€â”€ DEPLOY_GUIDE.md                                        # éƒ¨ç½²æŒ‡å—
```

## éƒ¨ç½²æµç¨‹

**é‡è¦è¯´æ˜**ï¼šæœ¬é¡¹ç›®é‡‡ç”¨"æ‰“åŒ… â†’ æœåŠ¡å™¨å®‰è£…ä¾èµ– â†’ PM2 å¯åŠ¨"çš„éƒ¨ç½²æ–¹å¼ã€‚

### æ ‡å‡†éƒ¨ç½²æµç¨‹

1. **æœ¬åœ°æ„å»ºå¹¶æ‰“åŒ…**
   ```bash
   # æ„å»º Next.js åº”ç”¨å¹¶æ‰“åŒ…
   pnpm run build:pack
   ```

2. **ä¸Šä¼ åˆ°æœåŠ¡å™¨**
   ```bash
   # ä¸Šä¼ å‹ç¼©åŒ…åˆ°æœåŠ¡å™¨
   scp dist/iku-research-agent-*.zip user@server:/var/www/
   ```

3. **æœåŠ¡å™¨ç«¯æ“ä½œ**
   ```bash
   # SSH ç™»å½•æœåŠ¡å™¨
   ssh user@server
   
   # è§£å‹éƒ¨ç½²åŒ…
   cd /var/www/
   unzip iku-research-agent-*.zip
   cd iku-research-agent
   
   # åˆ›å»ºæ—¥å¿—ç›®å½•
   mkdir -p logs
   
   # åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–ï¼ˆæ ¹æ® pnpm-lock.yamlï¼‰
   pnpm install --prod
   
   # é…ç½®ç¯å¢ƒå˜é‡
   vi .env.production
   
   # ä½¿ç”¨ PM2 å¯åŠ¨åº”ç”¨
   pm2 start ecosystem.config.js
   
   # è®¾ç½®å¼€æœºè‡ªå¯
   pm2 startup
   pm2 save
   ```

4. **éªŒè¯éƒ¨ç½²**
   ```bash
   # æŸ¥çœ‹åº”ç”¨çŠ¶æ€
   pm2 status
   
   # æµ‹è¯•è®¿é—®
   curl http://localhost:3000
   ```

### ä¸ºä»€ä¹ˆåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–ï¼Ÿ

1. **è·¨å¹³å°å…¼å®¹æ€§**ï¼šæŸäº›ä¾èµ–åŒ…å«åŸç”Ÿæ¨¡å—ï¼Œéœ€è¦åœ¨ç›®æ ‡å¹³å°ç¼–è¯‘
2. **å‡å°åŒ…ä½“ç§¯**ï¼šä¸æ‰“åŒ… node_modulesï¼Œéƒ¨ç½²åŒ…æ›´å°ï¼Œä¸Šä¼ æ›´å¿«
3. **ç‰ˆæœ¬ä¸€è‡´æ€§**ï¼šé€šè¿‡ pnpm-lock.yaml ç¡®ä¿ä¾èµ–ç‰ˆæœ¬å®Œå…¨ä¸€è‡´
4. **çµæ´»æ€§**ï¼šæœåŠ¡å™¨å¯ä»¥æ ¹æ®å®é™…ç¯å¢ƒå®‰è£…ä¼˜åŒ–çš„ä¾èµ–

### PM2 ä¼˜åŠ¿

- âœ… è¿›ç¨‹å®ˆæŠ¤ï¼šåº”ç”¨å´©æºƒè‡ªåŠ¨é‡å¯
- âœ… è´Ÿè½½å‡è¡¡ï¼šæ”¯æŒå¤šå®ä¾‹é›†ç¾¤æ¨¡å¼
- âœ… æ—¥å¿—ç®¡ç†ï¼šè‡ªåŠ¨æ”¶é›†å’Œè½®è½¬æ—¥å¿—
- âœ… é›¶åœæœºé‡å¯ï¼šæ›´æ–°åº”ç”¨ä¸å½±å“æœåŠ¡
- âœ… å¼€æœºè‡ªå¯ï¼šç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨åº”ç”¨

è¯¦ç»†éƒ¨ç½²æ­¥éª¤è¯·æŸ¥çœ‹æ‰“åŒ…åç”Ÿæˆçš„ `DEPLOY_GUIDE.md` æ–‡ä»¶ã€‚

## é…ç½®ä¿®æ”¹

å¦‚éœ€è‡ªå®šä¹‰æ‰“åŒ…å†…å®¹ï¼Œè¯·ç¼–è¾‘ `scripts/pack-deploy.js` ä¸­çš„ `config` å¯¹è±¡ï¼š

- `include`: æ·»åŠ éœ€è¦æ‰“åŒ…çš„æ–‡ä»¶/ç›®å½•
- `exclude`: æ·»åŠ éœ€è¦æ’é™¤çš„æ–‡ä»¶/ç›®å½•æ¨¡å¼

## æ³¨æ„äº‹é¡¹

1. **å¿…é¡»å…ˆæ„å»º**: ç¡®ä¿è¿è¡Œ `pnpm run build` ç”Ÿæˆ `.next` ç›®å½•
2. **ä¸æ‰“åŒ…ä¾èµ–**: éƒ¨ç½²åŒ…ä¸­**ä¸åŒ…å«** `node_modules`ï¼Œéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ `pnpm install --prod`
3. **é”æ–‡ä»¶å¿…éœ€**: `pnpm-lock.yaml` å¿…é¡»åŒ…å«åœ¨éƒ¨ç½²åŒ…ä¸­ï¼Œç¡®ä¿æœåŠ¡å™¨å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸€è‡´
4. **ç¯å¢ƒå˜é‡**: ç”Ÿäº§ç¯å¢ƒä¸è¦åŒ…å« `.env.local` å’Œ `.env.development`
5. **PM2 é…ç½®**: `ecosystem.config.js` å·²è‡ªåŠ¨åŒ…å«åœ¨éƒ¨ç½²åŒ…ä¸­
6. **æ—¥å¿—ç›®å½•**: æœåŠ¡å™¨ç«¯éœ€è¦æ‰‹åŠ¨åˆ›å»º `logs/` ç›®å½•ç”¨äº PM2 æ—¥å¿—
7. **Node ç‰ˆæœ¬**: æœåŠ¡å™¨éœ€è¦ Node.js >= 18.0.0
8. **åŒ…ç®¡ç†å™¨**: æ¨èä½¿ç”¨ pnpmï¼Œä¹Ÿå¯ä»¥ç”¨ npmï¼ˆä½†éœ€ç¡®ä¿ç‰ˆæœ¬å…¼å®¹ï¼‰

## PM2 é…ç½®è¯´æ˜

é¡¹ç›®åŒ…å« `ecosystem.config.js` é…ç½®æ–‡ä»¶ï¼Œä¸»è¦é…ç½®é¡¹ï¼š

```javascript
{
  name: 'iku-research-agent',           // åº”ç”¨åç§°
  script: 'node_modules/next/dist/bin/next',  // Next.js å¯åŠ¨è„šæœ¬
  args: 'start',                        // å¯åŠ¨å‚æ•°
  instances: 1,                         // å®ä¾‹æ•°é‡ï¼ˆå¯æ”¹ä¸º 'max'ï¼‰
  exec_mode: 'cluster',                 // é›†ç¾¤æ¨¡å¼
  env: {
    NODE_ENV: 'production',
    PORT: 3000,                         // ç«¯å£ï¼ˆå¯ä¿®æ”¹ï¼‰
  },
  error_file: './logs/error.log',      // é”™è¯¯æ—¥å¿—
  out_file: './logs/out.log',          // è¾“å‡ºæ—¥å¿—
  max_memory_restart: '1G',            // å†…å­˜é™åˆ¶
  autorestart: true,                   // è‡ªåŠ¨é‡å¯
}
```

### è‡ªå®šä¹‰é…ç½®

**ä¿®æ”¹ç«¯å£**ï¼š
```javascript
env: {
  PORT: 8080,  // æ”¹ä¸ºä½ éœ€è¦çš„ç«¯å£
}
```

**å¤šå®ä¾‹è´Ÿè½½å‡è¡¡**ï¼š
```javascript
instances: 'max',  // ä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒ
// æˆ–
instances: 4,      // å¯åŠ¨ 4 ä¸ªå®ä¾‹
```

**è°ƒæ•´å†…å­˜é™åˆ¶**ï¼š
```javascript
max_memory_restart: '2G',  // æ”¹ä¸º 2GB
```

## æ•…éšœæ’æŸ¥

### Q: æ‰“åŒ…å¤±è´¥ï¼Œæç¤ºç¼ºå°‘ .next ç›®å½•
A: å…ˆè¿è¡Œ `pnpm run build` ç”Ÿæˆæ„å»ºäº§ç‰©

### Q: æ‰“åŒ…çš„ ZIP æ–‡ä»¶å¤ªå¤§
A: æ­£å¸¸æƒ…å†µä¸‹ä¸åŒ…å« node_modulesï¼Œå¦‚æœè¿‡å¤§ï¼Œæ£€æŸ¥æ˜¯å¦è¯¯åŒ…å«äº†å…¶ä»–å¤§æ–‡ä»¶

### Q: æœåŠ¡å™¨ä¸Š pnpm install å¤±è´¥
A: 
1. æ£€æŸ¥ Node.js ç‰ˆæœ¬æ˜¯å¦ >= 18
2. ç¡®è®¤ pnpm å·²å®‰è£…ï¼š`npm install -g pnpm`
3. æ£€æŸ¥ pnpm-lock.yaml æ–‡ä»¶æ˜¯å¦å­˜åœ¨
4. å°è¯•åˆ é™¤ node_modules åé‡æ–°å®‰è£…

### Q: PM2 å¯åŠ¨å¤±è´¥
A: 
1. æ£€æŸ¥ logs ç›®å½•æ˜¯å¦å­˜åœ¨ï¼š`mkdir -p logs`
2. æ£€æŸ¥ ecosystem.config.js æ˜¯å¦å­˜åœ¨
3. æŸ¥çœ‹ PM2 æ—¥å¿—ï¼š`pm2 logs iku-research-agent`
4. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i :3000`

### Q: åº”ç”¨å¯åŠ¨åæ— æ³•è®¿é—®
A:
1. æ£€æŸ¥é˜²ç«å¢™ï¼š`sudo ufw status`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾ï¼š`sudo ufw allow 3000/tcp`
3. æ£€æŸ¥åº”ç”¨çŠ¶æ€ï¼š`pm2 status`
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`pm2 logs iku-research-agent --err`

### Q: ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ
A:
1. ç¡®è®¤ .env.production æ–‡ä»¶å­˜åœ¨
2. æ£€æŸ¥æ–‡ä»¶å†…å®¹æ ¼å¼æ˜¯å¦æ­£ç¡®
3. PM2 é‡å¯åº”ç”¨ï¼š`pm2 restart iku-research-agent --update-env`

## å¿«é€Ÿå‚è€ƒå‘½ä»¤

### æœ¬åœ°æ‰“åŒ…
```bash
# å®Œæ•´æ„å»ºå¹¶æ‰“åŒ…ï¼ˆæ¨èï¼‰
pnpm run build:pack

# ä»…æ‰“åŒ…ï¼ˆéœ€è¦å…ˆ buildï¼‰
pnpm run pack:prod

# æ‰“åŒ…å¼€å‘ç¯å¢ƒ
pnpm run pack:dev
```

### æœåŠ¡å™¨éƒ¨ç½²
```bash
# æ–¹å¼ 1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰
scp dist/*.zip scripts/server-deploy.sh user@server:/var/www/
ssh user@server "cd /var/www && bash server-deploy.sh"

# æ–¹å¼ 2: æ‰‹åŠ¨éƒ¨ç½²
ssh user@server
cd /var/www
unzip iku-research-agent-*.zip
cd iku-research-agent
mkdir -p logs
pnpm install --prod
pm2 start ecosystem.config.js
pm2 save
```

### PM2 ç®¡ç†
```bash
# å¯åŠ¨/é‡å¯/åœæ­¢
pm2 start ecosystem.config.js
pm2 restart iku-research-agent
pm2 stop iku-research-agent

# æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—
pm2 status
pm2 logs iku-research-agent
pm2 monit

# å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

## æœ€ä½³å®è·µ

1. **ç‰ˆæœ¬ç®¡ç†**
   - æ¯æ¬¡æ‰“åŒ…åä¿å­˜ zip æ–‡ä»¶ï¼Œæ–¹ä¾¿å›æ»š
   - æœåŠ¡å™¨ä¸Šä¿ç•™æœ€è¿‘ 2-3 ä¸ªç‰ˆæœ¬çš„å¤‡ä»½

2. **ç¯å¢ƒå˜é‡**
   - ä½¿ç”¨ `.env.production` ç®¡ç†ç”Ÿäº§ç¯å¢ƒé…ç½®
   - æ•æ„Ÿä¿¡æ¯ä¸è¦æäº¤åˆ° Git

3. **æ—¥å¿—ç›‘æ§**
   - å®šæœŸæŸ¥çœ‹ PM2 æ—¥å¿—ï¼š`pm2 logs`
   - è®¾ç½®æ—¥å¿—è½®è½¬é¿å…ç£ç›˜å æ»¡

4. **æ€§èƒ½ä¼˜åŒ–**
   - æ ¹æ®æœåŠ¡å™¨ CPU æ ¸å¿ƒæ•°è°ƒæ•´ PM2 å®ä¾‹æ•°
   - ä½¿ç”¨ `pm2 monit` ç›‘æ§å†…å­˜å’Œ CPU ä½¿ç”¨

5. **å®‰å…¨å»ºè®®**
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - ä½¿ç”¨ Nginx åå‘ä»£ç†
   - å®šæœŸæ›´æ–°ä¾èµ–åŒ…

## æ–‡ä»¶è¯´æ˜

- `pack-deploy.js` - ä¸»æ‰“åŒ…è„šæœ¬
- `server-deploy.sh` - æœåŠ¡å™¨ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- `README.md` - æœ¬è¯´æ˜æ–‡æ¡£

## æŠ€æœ¯æ”¯æŒ

- é¡¹ç›®ä»“åº“: https://github.com/assafelovic/gpt-researcher
- é—®é¢˜åé¦ˆ: è¯·åœ¨é¡¹ç›®ä»“åº“æäº¤ Issue
